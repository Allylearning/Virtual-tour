<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>360&deg; Image</title>
    <meta name="description" content="360&deg; Image - A-Frame">
    <script src="JS/aframe-master.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <link rel="stylesheet" href="Assets/Satoshi_Complete/Fonts/WEB/css/satoshi.css">
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="room1" src="Assets/office-modern-loft-2024-10-12-14-20-00-utc.jpg">
        <img id="room2" src="Assets/office-modern-loft-2024-10-18-07-37-50-utc.jpg">
      </a-assets>
      <a-sky id="sky" src="#room1" position="0 0 0"></a-sky>
      
      <a-entity id="room1-hotspots">
        <a-entity position="-4 0.75 -10" rotation="0 0 0">
          <!-- ONE background box behind both lines -->
          <a-plane width="10" height="5" color="#222" opacity="0.8" position="5 0 0"></a-plane>
          <!-- Top line of text -->
          <a-text font="roboto" value="Welcome to Your Virtual Office Tour!" width="12" position="0.5 1.5 0.01"></a-text>
          <!-- Bottom line of text -->
          <a-text font="roboto" value="Step into our digital workspace and get a feel for where the magic happens. In this short tour, you’ll explore two key areas of our office — each with interactive hotspots that share important info about how we work, collaborate, and care for each other. Take your time, click around, and get to know us better. Ready? Let’s go!" width="9" position="0.5 -0.5 0.01"></a-text>
        </a-entity>
        <a-entity id="hotspot1"
                  geometry="primitive: circle; radius: 0.5"
                  material="color: white; opacity: 1; shader: flat"
                  position="-6 3.5 -6"
                  rotation="0 45 0"
                  class="raycastable"
                  tabindex="0" role="button" aria-label="Hotspot 1"
                  event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                  event-set__leave="_event: mouseleave; scale: 1 1 1"
                  hotspot-click>
              <a-entity 
                  position="0 0 0.01" 
                  text="value: +; align: center; color: blue; width: 6" 
                  material="color: white; opacity: 0; shader: flat" 
                  rotation="0 0 0" 
                  geometry="primitive: plane; height: 0.3; width: 0.3">
              </a-entity>
        </a-entity>
        
        <a-entity id="hotspot2"
                  geometry="primitive: circle; radius: 0.5"
                  material="color: white; opacity: 1; shader: flat"
                  position="6 3.5 -2"
                  rotation="0 -70 0"
                  class="raycastable"
                  tabindex="0" role="button" aria-label="Hotspot 2"
                  event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                  event-set__leave="_event: mouseleave; scale: 1 1 1"
                  hotspot-click>
          <a-entity 
              position="0 0 0.01" 
              text="value: +; align: center; color: blue; width: 6" 
              material="color: white; opacity: 0; shader: flat" 
              rotation="0 0 0" 
              geometry="primitive: plane; height: 0.3; width: 0.3">
          </a-entity>
        </a-entity>

        <a-entity id="hotspot3"
                  geometry="primitive: circle; radius: 0.5"
                  material="color: white; opacity: 1; shader: flat"
                  position="6 5 4"
                  rotation="0 200 0"
                  class="raycastable"
                  tabindex="0" role="button" aria-label="Hotspot 3"
                  event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                  event-set__leave="_event: mouseleave; scale: 1 1 1"
                  hotspot-click>
          <a-entity 
              position="0 0 0.01" 
              text="value: +; align: center; color: blue; width: 6" 
              material="color: white; opacity: 0; shader: flat" 
              rotation="0 0 0" 
              geometry="primitive: plane; height: 0.3; width: 0.3">
          </a-entity>
        </a-entity>

        <a-entity id="hotspot4"
                  geometry="primitive: circle; radius: 0.5"
                  material="color: white; opacity: 1; shader: flat"
                  position="-10 3 0"
                  rotation="0 90 0"
                  class="raycastable"
                  tabindex="0" role="button" aria-label="Hotspot 4"
                  event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                  event-set__leave="_event: mouseleave; scale: 1 1 1"
                  hotspot-click>
          <a-entity 
              position="0 0 0.01" 
              text="value: +; align: center; color: blue; width: 6" 
              material="color: white; opacity: 0; shader: flat" 
              rotation="0 0 0" 
              geometry="primitive: plane; height: 0.3; width: 0.3">
          </a-entity>
        </a-entity>

      <a-entity id="portal-wrapper"
                  class="raycastable"
                  teleport-portal
                  tabindex="0" role="button" aria-label="Teleport Portal">
          <a-entity geometry="primitive: ring; radiusInner: 0.3; radiusOuter: 0.4"
                    class="raycastable"
                    material="color: white; shader: flat"
                    position="5 3.5 -7"
                    rotation="0 -70 0">
          </a-entity>
          <a-circle src="#room2" radius="0.35" position="5 3.5 -7.05" rotation="0 -70 0"
                    material="shader: flat; transparent: true; alphaTest: 0.5"
                    class="raycastable">
          </a-circle>
          <animation attribute="scale" begin="mouseenter" to="1.2 1.2 1.2" dur="200" easing="easeOutQuad"></animation>
          <animation attribute="scale" begin="mouseleave" to="1 1 1" dur="200" easing="easeOutQuad"></animation>
        </a-entity>
      </a-entity>

      <a-entity id="room2-hotspots" visible="false">
      <a-entity id="return-portal-wrapper"
                  class="raycastable"
                  return-portal
                  tabindex="0" role="button" aria-label="Return Portal">
          <a-entity geometry="primitive: ring; radiusInner: 0.3; radiusOuter: 0.4"
                    class="raycastable"
                    material="color: white; shader: flat"
                    position="-7 3.5 -1.5"
                    rotation="0 70 0">
          </a-entity>
          <a-circle src="#room1" radius="0.35" position="-7 3.5 -1.55" rotation="0 70 0"
                    material="shader: flat; transparent: true; alphaTest: 0.5"
                    class="raycastable">
          </a-circle>
          <animation attribute="scale" begin="mouseenter" to="1.2 1.2 1.2" dur="200" easing="easeOutQuad"></animation>
          <animation attribute="scale" begin="mouseleave" to="1 1 1" dur="200" easing="easeOutQuad"></animation>
        </a-entity>
        
        <a-entity id="hotspot5"
                  geometry="primitive: circle; radius: 0.5"
                  material="color: white; opacity: 1; shader: flat"
                  position="-7 5.5 -10.5"
                  rotation="0 70 0"
                  class="raycastable"
                  tabindex="0" role="button" aria-label="Hotspot 5"
                  event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                  event-set__leave="_event: mouseleave; scale: 1 1 1"
                  hotspot-click>
          <a-entity 
              position="0 0 0.01" 
              text="value: +; align: center; color: blue; width: 6" 
              material="color: white; opacity: 0; shader: flat" 
              rotation="0 0 0" 
              geometry="primitive: plane; height: 0.3; width: 0.3">
          </a-entity>
        </a-entity>

        <a-entity id="hotspot6"
                  geometry="primitive: circle; radius: 0.5"
                  material="color: white; opacity: 1; shader: flat"
                  position="0 5.5 -16.5"
                  rotation="0 0 0"
                  class="raycastable"
                  tabindex="0" role="button" aria-label="Hotspot 6"
                  event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                  event-set__leave="_event: mouseleave; scale: 1 1 1"
                  hotspot-click>
          <a-entity 
              position="0 0 0.01" 
              text="value: +; align: center; color: blue; width: 6" 
              material="color: white; opacity: 0; shader: flat" 
              rotation="0 0 0" 
              geometry="primitive: plane; height: 0.3; width: 0.3">
          </a-entity>
        </a-entity>
      </a-entity>
      
      <a-entity id="overlay1-3d" visible="false" position="0 3 -2" look-at="[camera]">
        <a-plane width="2.5" height="1.5" color="#222" shader="flat"></a-plane>
        <a-text value="Stay Safe" color="#fff" width="3" position="-1.1 0.4 0.01"></a-text>
        <a-text value="Emergency exits are clearly marked, and first aid kits are easy to find. If something goes wrong, follow the signs and evacuation plan." color="#ccc" width="2.3" position="-1.1 0.1 0.01" wrap-count="40"></a-text>
        <a-entity 
          geometry="primitive: plane; width: 1.5; height: 0.5" 
          material="color: #444; shader: flat" 
          position="0 -1.5 0.01" 
          class="raycastable" 
          close-3d-overlay>
            <a-text value="Close" align="center" color="#fff" width="3" position="0 0 0.01"></a-text>
        </a-entity>
      </a-entity>
      
      <a-entity id="overlay2-3d" visible="false" position="0 3 -2" look-at="[camera]">
        <a-plane width="2.5" height="1.5" color="#222" shader="flat"></a-plane>
        <a-text value="What We Believe In" color="#fff" width="3" position="-1.1 0.4 0.01"></a-text>
        <a-text value="We’re guided by curiosity, integrity, and empathy — not just words on a wall, but values we live by every day." color="#ccc" width="2.3" position="-1.1 0.1 0.01" wrap-count="40"></a-text>
        <a-entity 
          geometry="primitive: plane; width: 1.5; height: 0.5" 
          material="color: #444; shader: flat" 
          position="0 -1.5 0.01" 
          class="raycastable" 
          close-3d-overlay>
            <a-text value="Close" align="center" color="#fff" width="3" position="0 0 0.01"></a-text>
        </a-entity>
      </a-entity>

      <a-entity id="overlay3-3d" visible="false" position="0 3 -2" look-at="[camera]">
        <a-plane width="2.5" height="1.5" color="#222" shader="flat"></a-plane>
        <a-text value="Your Desk Setup" color="#fff" width="3" position="-1.1 0.4 0.01"></a-text>
        <a-text value="Set your screen at eye level, sit comfortably, and don’t forget to take breaks. Good posture means great work." color="#ccc" width="2.3" position="-1.1 0.1 0.01" wrap-count="40"></a-text>
        <a-entity 
          geometry="primitive: plane; width: 1.5; height: 0.5" 
          material="color: #444; shader: flat" 
          position="0 -1.5 0.01" 
          class="raycastable" 
          close-3d-overlay>
            <a-text value="Close" align="center" color="#fff" width="3" position="0 0 0.01"></a-text>
        </a-entity>
      </a-entity>

      <a-entity id="overlay4-3d" visible="false" position="0 3 -2" look-at="[camera]">
        <a-plane width="2.5" height="1.5" color="#222" shader="flat"></a-plane>
        <a-text value="Meet the Team" color="#fff" width="3" position="-1.1 0.4 0.01"></a-text>
        <a-text value="Get to know the people behind the projects. Hover to meet the team and hear their favourite thing about working here." color="#ccc" width="2.3" position="-1.1 0.1 0.01" wrap-count="40"></a-text>
        <a-entity 
          geometry="primitive: plane; width: 1.5; height: 0.5" 
          material="color: #444; shader: flat" 
          position="0 -1.5 0.01" 
          class="raycastable" 
          close-3d-overlay>
            <a-text value="Close" align="center" color="#fff" width="3" position="0 0 0.01"></a-text>
        </a-entity>
      </a-entity>

      <a-entity id="overlay5-3d" visible="false" position="0 3 -2" look-at="[camera]">
        <a-plane width="2.5" height="1.5" color="#222" shader="flat"></a-plane>
        <a-text value="Chill Out" color="#fff" width="3" position="-1.1 0.4 0.01"></a-text>
        <a-text value="Need a breather? Head to the kitchen, enjoy the quiet zone, or relax in our wellbeing space. You’ve earned it." color="#ccc" width="2.3" position="-1.1 0.1 0.01" wrap-count="40"></a-text>
        <a-entity 
          geometry="primitive: plane; width: 1.5; height: 0.5" 
          material="color: #444; shader: flat" 
          position="0 -1.5 0.01" 
          class="raycastable" 
          close-3d-overlay>
            <a-text value="Close" align="center" color="#fff" width="3" position="0 0 0.01"></a-text>
        </a-entity>
      </a-entity>

      <a-entity id="overlay6-3d" visible="false" position="0 3 -2" look-at="[camera]">
        <a-plane width="2.5" height="1.5" color="#222" shader="flat"></a-plane>
        <a-text value="Find Your Way" color="#fff" width="3" position="-1.1 0.4 0.01"></a-text>
        <a-text value="Maps and signposts are placed throughout the office to help you get where you’re going. Don’t worry — you won’t get lost!" color="#ccc" width="2.3" position="-1.1 0.1 0.01" wrap-count="40"></a-text>
        <a-entity 
          geometry="primitive: plane; width: 1.5; height: 0.5" 
          material="color: #444; shader: flat" 
          position="0 -1.5 0.01" 
          class="raycastable" 
          close-3d-overlay>
            <a-text value="Close" align="center" color="#fff" width="3" position="0 0 0.01"></a-text>
        </a-entity>
      </a-entity>

    <a-entity camera look-controls position="0 4 0">
        <a-entity cursor="fuse: false; rayOrigin: mouse"
                  position="0 0 -1"
                  material="color: white; shader: flat">
        </a-entity>
      </a-entity>

    <a-entity laser-controls="hand: left" raycaster="objects: .raycastable" line="color: #00FFC3"></a-entity>
    <a-entity laser-controls="hand: right" raycaster="objects: .raycastable" line="color: #00FFC3"></a-entity>
    <a-entity dismiss-3d-popups-on-click></a-entity>
    </a-scene>
    <div id="overlay1" class="overlay" style="display:none;" onclick="this.style.display='none'; checkCompletion();">
      <div class="overlay-box" onclick="event.stopPropagation()">
        <h2>Health & Safety</h2>
        <p>Emergency exits are clearly marked, and first aid kits are easy to find. If something goes wrong, follow the signs and evacuation plan.</p>
      </div>
    </div>
    <div id="overlay2" class="overlay" style="display:none;" onclick="this.style.display='none'; checkCompletion();">
      <div class="overlay-box" onclick="event.stopPropagation()">
        <h2>Company Values</h2>
        <p>We’re guided by curiosity, integrity, and empathy — not just words on a wall, but values we live by every day.</p>
      </div>
    </div>
    <div id="overlay3" class="overlay" style="display:none;" onclick="this.style.display='none'; checkCompletion();">
      <div class="overlay-box" onclick="event.stopPropagation()">
        <h2>Your Desk Setup</h2>
        <p>Set your screen at eye level, sit comfortably, and don’t forget to take breaks. Good posture means great work.</p>
      </div>
    </div>
    <div id="overlay4" class="overlay" style="display:none;" onclick="this.style.display='none'; checkCompletion();">
      <div class="overlay-box" onclick="event.stopPropagation()">
        <h2>Meet the Team</h2>
        <p>Get to know the people behind the projects. Hover to meet the team and hear their favourite thing about working here.</p>
      </div>
    </div>
    <div id="overlay5" class="overlay" style="display:none;" onclick="this.style.display='none'; checkCompletion();">
      <div class="overlay-box" onclick="event.stopPropagation()">
        <h2>Chill Out</h2>
        <p>Need a breather? Head to the kitchen, enjoy the quiet zone, or relax in our wellbeing space. You’ve earned it.</p>
      </div>
    </div>
    <div id="overlay6" class="overlay" style="display:none;" onclick="this.style.display='none'; checkCompletion();">
      <div class="overlay-box" onclick="event.stopPropagation()">
        <h2>Find Your Way</h2>
        <p>Maps and signposts are placed throughout the office to help you get where you’re going. Don’t worry — you won’t get lost!</p>
      </div>
    </div>
    <div id="restart-message" class="overlay" style="display:none;" onclick="event.stopPropagation()">
      <div class="overlay-box" onclick="event.stopPropagation()">
        <h2>You’ve Completed the Tour!</h2>
        <p>Thanks for exploring our space — now you know your way around!</p>
        <p>Feel free to take another look anytime. Just tap the button below to restart.</p>
        <button id="restart-button" style="margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem;">Restart Simulation</button>
      </div>
    </div>
    <style>
      .overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 1000;
      }
      .overlay-box {
        background: #fff;
        padding: 1rem 2rem;
        border-radius: 10px;
        text-align: left;
        max-width: 400px;
        color: #222;
        font-family: 'Satoshi', sans-serif;    
      }
      a-entity:focus {
        outline: 2px solid yellow;
      }
      #restart-message button {
        background: #004cff;
        border: none;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        width: 100%;
        font-family: 'Satoshi', sans-serif;
        font-weight: bold;
      }
      #restart-message button:hover {
        background: #003bc4;
      }
    </style>
    <script>
      // Hotspot and overlay tracking variables moved to top for access in all components
      const hotspotIdsRoom1 = ['hotspot1', 'hotspot2', 'hotspot3', 'hotspot4'];
      const hotspotIdsRoom2 = ['hotspot5', 'hotspot6'];
      const visitedHotspots = new Set();

      AFRAME.registerComponent('hotspot-click', {
        init: function () {
          const id = this.el.getAttribute('id');
          const overlayId = 'overlay' + id.replace('hotspot', '');
          this.el.addEventListener('click', () => {
            const sceneEl = this.el.sceneEl;
            if (sceneEl.is('vr-mode')) {
              document.querySelectorAll('[id^="overlay"][id$="-3d"]').forEach(o => o.setAttribute('visible', false));
              const overlay3D = document.getElementById(overlayId + '-3d');
              if (overlay3D) overlay3D.setAttribute('visible', true);
            } else {
              document.querySelectorAll('.overlay').forEach(o => o.style.display = 'none');
              const overlay = document.getElementById(overlayId);
              if (overlay) {
                overlay.style.display = 'flex';
                this.el.setAttribute('material', 'color', 'gray');
                const plusIcon = this.el.querySelector('[text]');
                if (plusIcon) {
                  plusIcon.setAttribute('text', 'color', 'white');
                }

                // ✅ Add hotspot to visited set
                visitedHotspots.add(id);
                setTimeout(() => {
                  if (!document.querySelector(`#${overlayId}`).style.display) {
                    checkCompletion();
                  } else {
                    const observer = new MutationObserver((mutationsList, observer) => {
                      if (document.querySelector(`#${overlayId}`).style.display === 'none') {
                        observer.disconnect();
                        checkCompletion();
                      }
                    });
                    observer.observe(document.querySelector(`#${overlayId}`), { attributes: true, attributeFilter: ['style'] });
                  }
                }, 0);
              }
            }
          });
          this.el.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
              this.el.emit('click');
            }
          });
        }
      });

      AFRAME.registerComponent('close-3d-overlay', {
        init: function () {
          this.el.addEventListener('click', function () {
            const overlay = this.closest('[id^="overlay"][id$="-3d"]');
            if (overlay) {
              overlay.setAttribute('visible', false);
              overlay.setAttribute('position', '1000 1000 1000'); // 🚀 move it far away!
            }
          });
        }
      });

      AFRAME.registerComponent('teleport-portal', {
        init: function () {
          this.el.addEventListener('click', () => {
            const sky = document.getElementById('sky');
            sky.setAttribute('src', '#room2');
            document.getElementById('room1-hotspots').setAttribute('visible', false);
            document.getElementById('room2-hotspots').setAttribute('visible', true);
          });
        }
      });

      AFRAME.registerComponent('return-portal', {
        init: function () {
          this.el.addEventListener('click', () => {
            const sky = document.getElementById('sky');
            sky.setAttribute('src', '#room1');
            document.getElementById('room2-hotspots').setAttribute('visible', false);
            document.getElementById('room1-hotspots').setAttribute('visible', true);
          });
        }
      });


      AFRAME.registerComponent('follow-camera', {
        tick: function () {
          if (!this.el.getAttribute('visible')) return;
          const camera = document.querySelector('[camera]');
          if (!camera) return;
          const camWorldPos = new THREE.Vector3();
          camera.object3D.getWorldPosition(camWorldPos);
          const camWorldDir = new THREE.Vector3();
          camera.object3D.getWorldDirection(camWorldDir);

          // Offset to place the popup in front and slightly below
          const offset = camWorldDir.clone().multiplyScalar(2); // 2 meters forward
          offset.y -= 1; // 1 meter down

          const newPos = camWorldPos.add(offset);
          this.el.object3D.position.copy(newPos);
          this.el.object3D.lookAt(camWorldPos);
        }
      });
function checkCompletion() {
  const allVisitedRoom1 = hotspotIdsRoom1.every(id => visitedHotspots.has(id));
  const allVisitedRoom2 = hotspotIdsRoom2.every(id => visitedHotspots.has(id));
  if (allVisitedRoom1 && allVisitedRoom2) {
    document.getElementById('restart-message').style.display = 'flex';
    confetti({
      particleCount: 150,
      spread: 70,
      origin: { y: 0.6 }
    });
  }
}

document.getElementById('restart-button').addEventListener('click', () => {
  visitedHotspots.clear();
  document.getElementById('restart-message').style.display = 'none';
  document.getElementById('sky').setAttribute('src', '#room1');
  document.getElementById('room1-hotspots').setAttribute('visible', true);
  document.getElementById('room2-hotspots').setAttribute('visible', false);

  // Reset hotspot visuals
  [...hotspotIdsRoom1, ...hotspotIdsRoom2].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.setAttribute('material', 'color', 'white');
      const plusIcon = el.querySelector('[text]');
      if (plusIcon) {
        plusIcon.setAttribute('text', 'color', 'blue');
      }
    }
  });
});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  </body>
</html>